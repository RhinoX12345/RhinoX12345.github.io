<!DOCTYPE html>
<html>
    <head>
        <title>Nerdle</title>
        <style>
            body{
                width:max-content;
            }
            table{
                color:black;
                border:1px solid black;
                border-spacing:0;
                text-align:center;
                background-color:aliceblue;
                font-size:25px;
                font-family:"Segoe UI";
                margin: 50px auto;
            }
            td{
                height:50px;
                width:50px;
                padding:0;
                border:1px solid black;
                cursor:pointer;
            }
            #inputs{
                top: 50px;
                left: 500px;
            }
            td:hover{
                background-color:rgb(220, 228, 235);
            }

            .inputButton {
                border: 1px solid black;
                border-radius: 2px;
            }
        </style>
        <script>
            let possibleAnswers = ["8*3-5=19","37*4=148","7*8/4=14","42/3/2=7"]
            let cells=[], selectedCell="00", attempts = 1,eqLen = 1, currentAttempt = 1, currentAnswerId = 0;

            function pageLoad(){
                setup(6,8);
            }

            function setup(att=6, len=8){
                eqLen = len;
                attempts = att;
                currentAttempt = 1;
                currentAnswerId = Math.floor(Math.random()*possibleAnswers.length)%possibleAnswers.length;
                document.getElementById("board").innerHTML="";
                for (let i=0; i<attempts; i++){
                    document.getElementById("board").innerHTML+=`<tr id=${i}></tr>`;
                    for (let j=0; j<eqLen; j++){
                        document.getElementById(i).innerHTML+=`<td id=${i}${j}></td>`;
                        cells.push(`${i}${j}`)
                    }
                }
                for (let i of cells){
                    document.getElementById(i).addEventListener("click", e=>click(i));
                }
                click(selectedCell)
            }

            function click(id){
                let lightblue = "rgb(240, 248, 255)";
                let lightgray = "rgb(215, 223, 230)";
                let darkgray = "rgb(185, 190, 195)";
                if (id[0]<currentAttempt-1){return -1;}
                selectedCell = id;
                for (let i in cells){
                    if (cells[i][0]>=currentAttempt-1){
                        document.getElementById(cells[i]).style.backgroundColor=lightblue;
                    }
                }
                for (let i=0; i<eqLen; i++){
                    document.getElementById(`${id[0]}${i}`).style.backgroundColor=lightgray;
                }
                document.getElementById(id).style.backgroundColor=darkgray;
            }

            function set(input){
                if (selectedCell == "" ){
                    return -1;
                } else if (typeof(input)=="number") {
                    document.getElementById(selectedCell).innerHTML = input;
                } else if (typeof(input)=="string") {
                    if (input=="enter"){
                        submit();
                        return -1;
                    } else if (input=="del"){
                        if (document.getElementById(selectedCell).innerHTML=="" && Number(selectedCell[1])>0){
                            document.getElementById(`${selectedCell[0]}${Number(selectedCell[1])-1}`).innerHTML = "";
                        }
                        document.getElementById(selectedCell).innerHTML = "";
                    } else {
                        document.getElementById(selectedCell).innerHTML = input;
                    }
                }
                if (input=="del"){
                    if (Number(selectedCell[1])>0){
                        click(`${selectedCell[0]}${Number(selectedCell[1])-1}`);
                    }
                } else if (Number(selectedCell[1])<eqLen-1){
                    click(`${selectedCell[0]}${Number(selectedCell[1])+1}`);
                } else {
                    click(selectedCell);
                }
            }

            function submit(){
                let clrCorrect="#5fd4b6"; //#3d8875
                let clrPosition="#a60c70"; //#800a57
                let clrWrong="#606060"; //#161802
                let ans = ""
                for (let i=0; i<eqLen; i++){
                    ans += document.getElementById(`${currentAttempt-1}${i}`).innerHTML
                }
                if (ans.indexOf("=")==-1){console.log("Invalid");return -1;}
                try {
                    eval(ans.split("=")[0]);
                    eval(ans.split("=")[1]);
                } catch {
                    console.log("Invalid");return -1;
                }
                console.log("Valid");
                if (ans==possibleAnswers[currentAnswerId]){
                    console.log("Correct");
                    for (let i=0; i<eqLen; i++){
                        document.getElementById(`${currentAttempt-1}${i}`).style.backgroundColor = clrCorrect;
                    }
                } else {
                    console.log("Incorrect")
                    let code = ""
                    let tempCode = [];
                    let answer = possibleAnswers[currentAnswerId];
                    let valCount = {0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,"+":0,"-":0,"*":0,"/":0,"=":0}
                    for (let i in ans){
                        if (ans[i]==answer[i]){
                            tempCode.push("1");
                            valCount[Number(ans[i])]+=1
                        } else {
                            tempCode.push("0");
                        }
                    }
                    for (let i in tempCode){
                        if (answer.indexOf(ans[i])>-1 && tempCode[i]!=1){
                            let n = answer.split("").toSorted().lastIndexOf(ans[i]) - answer.split("").toSorted().indexOf(ans[i])+1;
                            if (valCount[Number(ans[i])]<n){
                                valCount[Number(ans[i])]+=1;
                                code += "2";
                            } else {
                                code += tempCode[i];
                            }
                        } else {
                            code += tempCode[i];
                        }
                    }
                    for (let i in code){
                        if (code[i]==0){
                            document.getElementById(`${currentAttempt-1}${i}`).style.backgroundColor = clrWrong;
                        } else if (code[i]==1){
                            document.getElementById(`${currentAttempt-1}${i}`).style.backgroundColor = clrCorrect;
                        } else if (code[i]==2){
                            document.getElementById(`${currentAttempt-1}${i}`).style.backgroundColor = clrPosition;
                        }
                    }
                }
                currentAttempt+=1;
                click(`${currentAttempt-1}0`)
            }

            function keyInput(){
                if (event.repeat==false){
                    switch (event.key){
                        case "ArrowUp":
                        if (Number(selectedCell[0])>0){
                            click(`${Number(selectedCell[0])-1}${selectedCell[1]}`);
                        }
                        break;
                        case "ArrowDown":
                        if (Number(selectedCell[0])<attempts-1){
                            click(`${Number(selectedCell[0])+1}${selectedCell[1]}`);
                        }
                        break;
                        case "ArrowRight":
                        if (Number(selectedCell[1])<eqLen-1){
                            click(`${selectedCell[0]}${Number(selectedCell[1])+1}`);
                        }
                        break;
                        case "ArrowLeft":
                        if (Number(selectedCell[1])>0){
                            click(`${selectedCell[0]}${Number(selectedCell[1])-1}`);
                        }
                        break;
                        case "Backspace":
                            set("del");
                        break;
                        case "Delete":
                            set("del");
                        break;
                        case "Enter":
                            set("enter");
                        break;
                    }
                    if ("1234567890+-*/=".split("").indexOf(event.key)>=0){
                        set(event.key);
                    }
                }
            }
        </script>
    </head>
    <body onload="pageLoad()" onkeydown="keyInput(event)">
        <button onclick="setup(6,8)">Load</button>
        <br><br>
        <table id="board"></table>
        <table id="inputs">
            <tr>
                <td onclick="set(1)">1</td>
                <td onclick="set(2)">2</td>
                <td onclick="set(3)">3</td>
                <td onclick="set(4)">4</td>
                <td onclick="set(5)">5</td>
                <td onclick="set(6)">6</td>
                <td onclick="set(7)">7</td>
                <td onclick="set(8)">8</td>
                <td onclick="set(9)">9</td>
                <td onclick="set(0)">0</td>
            </tr>
            <tr>
                <td onclick="set('+')">+</td>
                <td onclick="set('-')">-</td>
                <td onclick="set('*')">*</td>
                <td onclick="set('/')">/</td>
                <td onclick="set('=')">=</td>
                <td onclick="set('enter')" colspan="3">Enter</td>
                <td onclick="set('del')" colspan="2">Del</td>
            </tr>
        </table>
    </body>
</html>